function t(e,s=!1){s&&e.reverse();let r=e.filter(t=>0!==t),a=[],i=0;for(let t=0;t<r.length;t++)if(r[t]===r[t+1]){let e=2*r[t];a.push(e),i+=e,t++}else a.push(r[t]);for(;a.length<e.length;)a.push(0);return s&&a.reverse(),{merged:a,mergeSum:i}}class e{static STATUS={waiting:"waiting",playing:"playing",win:"win",lose:"lose"};constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.score=0,this.status=e.STATUS.waiting,this.initialState=t,this.state=t.map(t=>[...t])}move(s){if(this.status!==e.STATUS.playing)return;let r=this.state.map(t=>[...t]),a=!1,i=0,n=[];return"left"===s||"right"===s?n=this.state.map(e=>{let{merged:r,mergeSum:n}=t("right"===s?e.reverse():e);return i+=n,a||r.every((t,s)=>t===e[s])||(a=!0),"right"===s?r.reverse():r}):(n=this.transpose(this.state).map(e=>{let{merged:r,mergeSum:n}=t("down"===s?e.reverse():e);return i+=n,a||r.every((t,s)=>t===e[s])||(a=!0),"down"===s?r.reverse():r}),n=this.transpose(n)),a?(this.state=n,this.score+=i,this.addNumbers(),this.setState(),this.checkStatus()):this.state=r,a}moveLeft(){return this.move("left")}moveRight(){return this.move("right")}moveUp(){return this.move("up")}moveDown(){return this.move("down")}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=e.STATUS.playing,this.state=this.initialState.map(t=>[...t]),this.addNumbers(),this.addNumbers(),this.setState()}restart(){this.score=0,this.status=e.STATUS.waiting,this.state=this.initialState.map(t=>[...t]),this.setState()}addNumbers(){let t=this.state.flatMap((t,e)=>t.map((t,s)=>0===t?{r:e,c:s}:null)).filter(Boolean);if(t.length){let{r:e,c:s}=t[Math.floor(Math.random()*t.length)];this.state[e][s]=.9>Math.random()?2:4}}setState(){document.querySelectorAll(".field-cell").forEach((t,e)=>{let s=this.state.flat()[e];t.className="field-cell",t.textContent=s||"",s&&t.classList.add(`field-cell--${s}`)})}checkStatus(){if(this.state.some(t=>t.includes(2048))){this.status=e.STATUS.win;return}if(!this.state.some(t=>t.includes(0))){for(let t=0;t<4;t++)for(let e=0;e<3;e++)if(this.state[t][e]===this.state[t][e+1]||this.state[e][t]===this.state[e+1][t])return;this.status=e.STATUS.lose}}}const s=new e,r=document.querySelector(".button"),a=document.querySelector(".message-start"),i=document.querySelector(".message-lose"),n=document.querySelector(".message-win"),o=document.querySelector(".game-score");r.addEventListener("click",function(){r.classList.toggle("restart"),r.classList.toggle("start"),a.classList.toggle("hidden"),i.classList.add("hidden"),n.classList.add("hidden"),o.textContent=0,r.className.includes("start")&&(r.textContent="Start",s.restart(),r.classList.remove("button--highlight")),r.className.includes("restart")&&(r.textContent="Restart",s.start()),document.addEventListener("keydown",h)});const l=()=>document.removeEventListener("keydown",h);function h(t){if(s.getStatus()===e.STATUS.playing){let e=!1;switch(t.key){case"ArrowLeft":e=s.moveLeft();break;case"ArrowRight":e=s.moveRight();break;case"ArrowUp":e=s.moveUp();break;case"ArrowDown":e=s.moveDown()}e&&(o.textContent=s.score)}s.getStatus()===e.STATUS.lose&&(i.classList.remove("hidden"),r.classList.add("button--highlight"),l()),s.getStatus()===e.STATUS.win&&(n.classList.remove("hidden"),l()),t.preventDefault()}document.addEventListener("keydown",h);
//# sourceMappingURL=index.968339ca.js.map
